<!DOCTYPE html>
<html>
<head>
<title>Digi Wallet</title>
<link rel="stylesheet" type="text/css" href="css/style.css">
<script src="js/jquery.min.js"></script>
<script src="js/config.js"></script>


<script>
var contentType ="application/x-www-form-urlencoded; charset=utf-8";
if(window.XDomainRequest){contentType = "text/plain";}
jQuery.support.cors = true;

jQuery( document ).ready(function() {

var spin =localStorage.getItem("pin");
alert(spin);
	if(window.sessionStorage.getItem("loggedIn") == 1) {
	
		// Check Session
		var userid = sessionStorage.getItem("user_id") ;
		var password = sessionStorage.getItem("password") ;
		var uid = sessionStorage.getItem("uid") ;
		
		jQuery('.logout').hide();
		jQuery('.log-out').click(function(){
			jQuery('.logout').toggle( "slow" );
		});
		
		// Get Login data
		$.ajax({
		  url: siteurl+"login",
		  type: 'POST',
		  data: {q:'checklogin',user_id:userid,password:password}, 
		  crossDomain: true,   
		  success: function(data) {
			if(data['status'] == 1)
			{
				var user_otp = data['details']['u_pin'];
				//alert(user_otp);
				// Concatinate otp value
				jQuery(".spin").keyup(function () {
					if (this.value.length == this.maxLength) {
					  var $next = $(this).next('.spin');
					  if ($next.length){
						  $(this).next('.spin').focus();
					  }
					  else{
						  $(this).blur();
						  var optcvalue='';
							jQuery('.spin').each(function(){
							   optcvalue+=this.value;
							});
						  if(optcvalue == user_otp)
						  {
							window.location='dashboard.html';
						  }else{
							$("#snackbar").fadeIn("slow", function () {
								setTimeout(function () {
									$("#snackbar").fadeOut("slow");
								}, 5000);
								window.location='securitypin.html';
							});
						  }
					  }
						  
					
					}
				});
			}
			else{
				//window.location='login.html';
			}
		  },
		  error: function() {
			alert('Error');
		  }
		});
	}
	else
	{
		if(spin != ''){
			jQuery(".spin").keyup(function () {
					if (this.value.length == this.maxLength) {
					  var $next = $(this).next('.spin');
					  if ($next.length){
						  $(this).next('.spin').focus();
					  }
					  else{
						  $(this).blur();
						  var optcvalue='';
							jQuery('.spin').each(function(){
							   optcvalue+=this.value;
							});
						  if(optcvalue == spin)
						  {
							window.location='dashboard.html';
						  }else{
							$("#snackbar").fadeIn("slow", function () {
								setTimeout(function () {
									$("#snackbar").fadeOut("slow");
								}, 5000);
							});
						  }
					  }
						  
					
					}
				});
		}
	}
});
</script>
</head>
<body>

<div id="main_wrapper">
	<div class="main-container">
		<div id="top_header_pin">
			<div class="logo-pin">
				<div class="logo-pin-img"><img src="images/logo-digi6.png"/></div>
			<!-- 	<div class="logo-pin-text">Digi Wallet</div> -->
			</div>
		</div>
		<div class="pin-container">
			<div class="pin-verify">
						<div class="pin-msg">Enter Securtiy Pin</div>
						<div class="spin-textbox">
							<input type="password" name="spin0" class="spin" maxlength=1 pattern="[0-9]*"/>
							<input type="password" name="spin1" class="spin" maxlength=1 pattern="[0-9]*"/>
							<input type="password" name="spin2" class="spin" maxlength=1 pattern="[0-9]*"/>
							<input type="password" name="spin3" class="spin" maxlength=1 pattern="[0-9]*"/>
						</div>
			</div>
			<div class="input-button">
				<input type="button" name="submit" class="green-button-s" value="Don't Remember Pin"/>
			</div>
		</div>
	</div>
</div>
<div id="snackbar" style="display:none;">Enter the correct pin</div>
</body>
</html>