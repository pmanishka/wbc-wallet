<!DOCTYPE html>
<html>
<head>
<title>World Bank of Cryptocurrencies</title>
<link rel="stylesheet" type="text/css" href="css/style.css">
<script src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/jquery.qrcode.min.js"></script>
<script type="text/javascript" src="js/jquery.scannerdetection.js"></script>
</head>
<body>

<div id="main_wrapper" class="inner-page">
	<div class="main-container">
	<div id="topbar">
		<img src="images/back_arrow.png"/>Step 5
	</div>
	<div id="top_header">
		<div class="logo">
			<div class="logo-img"><img src="images/gif_logo.gif"></div>
			<div class="logo-text">World Bank of Cryptocurrencies</div>
		</div>
	</div>
	<!--
	Ideally these elements aren't created until it's confirmed that the 
	client supports video/camera, but for the sake of illustrating the 
	elements involved, they are created with markup (not JavaScript)
	-->
	<video id="video" width="640" height="480" autoplay></video>
	<button id="snap">Snap Photo</button>
	<canvas id="canvas" width="640" height="480"></canvas>
	
	<div class="container">
		<div class="registertop">
			5. Password and PIN
		</div>
		
		<div class="register-form reg-step4">
			<form method="post" id="setpassword" action="">
				<div class="input-field password">
					<input type="text" name="password" id="password" class="password" placeholder="Password"/>
					<span class="validate-error"></span>
				</div>
				<div class="input-field cpassword">
					<input type="text" name="repeat-password" class="password_confirm" id="password_confirm" placeholder="Repeat Password"/>
					<span class="validate-error"></span>
				</div>
				<div class="input-field pin">
					<input type="text" name="pin" id="pin" class="pin" placeholder="4 Digit Pin" minlength="4" maxlength="4" />
					<span class="validate-error"></span>
				</div>
				<div class="input-field cpin">
					<input type="text" name="repeat-pin" class=" cpin" id="cpin" placeholder="Repeat Pin" minlength="4" maxlength="4"/>
					<span class="validate-error"></span>
				</div>
				<div class="red-button">
					<input type="button" class="next" id="passSubmit" name="submit" value="Submit"/>
				</div>
			</form>
			
		</div>
	</div>
</div>


<script>
var contentType ="application/x-www-form-urlencoded; charset=utf-8";
if(window.XDomainRequest){contentType = "text/plain";}
jQuery.support.cors = true;



// Grab elements, create settings, etc.
var video = document.getElementById('video');

// Get access to the camera!
if(navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
    // Not adding `{ audio: true }` since we only want video now
    navigator.mediaDevices.getUserMedia({ video: true }).then(function(stream) {
        video.src = window.URL.createObjectURL(stream);
        video.play();
    });
}

/* Legacy code below: getUserMedia 
else if(navigator.getUserMedia) { // Standard
    navigator.getUserMedia({ video: true }, function(stream) {
        video.src = stream;
        video.play();
    }, errBack);
} else if(navigator.webkitGetUserMedia) { // WebKit-prefixed
    navigator.webkitGetUserMedia({ video: true }, function(stream){
        video.src = window.webkitURL.createObjectURL(stream);
        video.play();
    }, errBack);
} else if(navigator.mozGetUserMedia) { // Mozilla-prefixed
    navigator.mozGetUserMedia({ video: true }, function(stream){
        video.src = window.URL.createObjectURL(stream);
        video.play();
    }, errBack);
}
*/


// Elements for taking the snapshot
var canvas = document.getElementById('canvas');
var context = canvas.getContext('2d');
var video = document.getElementById('video');

// Trigger photo take
document.getElementById("snap").addEventListener("click", function() {
	context.drawImage(video, 0, 0, 640, 480);
});

jQuery( document ).ready(function() {

var adhar_card_no = "";


	jQuery("input[name='submit']").click(function () {
	
	jQuery('.password .validate-error').empty('');
	jQuery('.cpassword .validate-error').empty('');
	jQuery('.pin .validate-error').empty('');
	jQuery('.cpin .validate-error').empty('');
	
		var password = $("#password").val();
		var confirmPassword = $("#password_confirm").val();
		var pin = $("#pin").val();
		var cpin = $("#cpin").val();
		
		if (password != '') {
			if (password != confirmPassword) {
				jQuery('.cpassword .validate-error').append('Passwords do not match');
				return false;
			}
		}else{
			jQuery('.password .validate-error').append('Password should not be blank');
		}
		
		if (pin != '') {
			if (pin != cpin) {
				jQuery('.cpin .validate-error').append('Pin do not match');
				return false;
			}
		}else{
			jQuery('.pin .validate-error').append('Pin should not be blank');
		}
		
		var username = localStorage.getItem("username");
		var email = localStorage.getItem("email");
		var fullname = localStorage.getItem("fullname");
		var dob = localStorage.getItem("dob");
		var address = localStorage.getItem("address");
		var city = localStorage.getItem("city");
		var state = localStorage.getItem("state");
		var country = localStorage.getItem("country");
		var postalcode = localStorage.getItem("postalcode");
		var mobile = localStorage.getItem('mobile');
		
		var registrationData = {
		  "userName" : username,
		  "Email" : email,
		  "Name" : fullname,
		  "Mobile" : mobile,
		  "Dob" : dob,
		  "Address" : address,
		  "City" : city,
		  "State" : state,
		  "country" : country,
		  "PostalPin" : postalcode,
		  "Password" : password,
		  "Pin" : pin,
		  "Otp" : '1232'
		};
		
		var rdata = JSON.stringify(registrationData);
		
		$.ajax({
			  url: "http://10.0.0.66/Regular/cryptocurrency/api/userRegistrationData",
			  type: 'POST',
			  dataType: "json",
			  data: {q:'registrationData', registrationData: rdata},
			  crossDomain: true,   
			  success: function(data) {
				if(data['status'] == 1)
				{
					alert('Register Successfully');
					//window.location='reg-step6.html';
				}else{
					alert('Registeration Failed');
				}
			  },
			  error: function() {
				alert('Failed');
			  }
		});
		
		//return true;
    });
		
});
</script>
</body>
</html>