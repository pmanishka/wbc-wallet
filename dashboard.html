<!DOCTYPE html>
<html>
<head>
<title>Digi Wallet</title>
<link rel="stylesheet" type="text/css" href="css/style.css">
<link rel="stylesheet" href="css/jquery.mmenu.all.css" />

<script src="js/jquery.min.js"></script>
<script src="js/jquery.mmenu.all.js"></script>
<script src="js/config.js"></script>
<script type="text/javascript" src="http://www.jqueryflottutorial.com/js/flot/jquery.flot.min.js"></script>
<script type="text/javascript" src="http://www.jqueryflottutorial.com/js/flot/jquery.flot.time.js"></script>    
<script type="text/javascript" src="http://www.jqueryflottutorial.com/js/flot/jshashtable-2.1.js"></script>    
<script type="text/javascript" src="http://www.jqueryflottutorial.com/js/flot/jquery.numberformatter-1.2.3.min.js"></script>
<script type="text/javascript" src="http://www.jqueryflottutorial.com/js/flot/jquery.flot.symbol.js"></script>
<script type="text/javascript" src="http://www.jqueryflottutorial.com/js/flot/jquery.flot.axislabels.js"></script>


<script type="text/javascript">
$(function() {
	$('nav#menu').mmenu();
	$( "nav#menu .mm-panels" ).addClass( "profile-menu" );
});
jQuery.support.cors = true;
touchMove = function(event) {
      event.preventDefault();
}
</script>
<script>

var contentType ="application/x-www-form-urlencoded; charset=utf-8";
if(window.XDomainRequest){contentType = "text/plain";}
jQuery.support.cors = true;

jQuery( document ).ready(function() {


	if(window.sessionStorage.getItem("loggedIn") == 1) {
		var userid = sessionStorage.getItem("user_id") ;
		var password = sessionStorage.getItem("password") ;
		var uid = sessionStorage.getItem("uid") ;
		//alert(uid);
		
		
		$.ajax({
		  url: siteurl+"login",
		  type: 'POST',
		  data: {q:'checklogin',user_id:userid,password:password}, 
		  crossDomain: true,   
		  success: function(data) {
			if(data['status'] == 1)
			{
				var name = jQuery('.name').append(data['details']['name']);
				var email = jQuery('.uemail').append(data['details']['email']);
				
				var card_id = data['details']['card_type'];
				//alert(card_id);
				// Get Card Type
				var card = data['card'] ;
				$.each(card, function(idx, obj) {
				
					if(obj.id == card_id){
					//alert(obj.card_name);
						var card_type = jQuery('.card_type').append(obj.card_name);
					}
				});
				var picon = data['details']['name'];
				var profile = jQuery('.profile-icon').append(picon.charAt(0));
				var verifystatus = data['details']['emailverifystatus'];
				if(typeof verifystatus!='undefined' && verifystatus!='' && verifystatus!=null && verifystatus=='1'){
					jQuery('.verify').append("Verified");
				}else{
					jQuery('.verify').append("Unverified");
				}
				var dcard = data['details']['my_card_no'];
				
				dcard = dcard.replace(/(\S{4})/g,"$1 ");
				dcard = dcard.replace(/$/,"");   // if you do not want the final a
				var digicard = jQuery('.digi-num div').append(dcard);
				var btcbal = jQuery('.balance-footer').append(data['details']['net_btc_bal']);
				
				
			}
			else{
				window.location='login.html';
			}
		  },
		  error: function() {
			alert('Error');
		  }
		});
		
		
		
		// Get BitPay Data
		$.ajax({
        type: 'GET',
        url: 'https://bitpay.com/api/rates',
        dataType: 'json',
        async: false,
			success: function (response) {
				$.each(response, function(idx, obj) {
					if(obj.code == 'USD'){
						jQuery('.live-footer span.amount').append(obj.rate);
					}
				});
			}
		});
		

		// Get Live Chart Data
		$.ajax({
        type: 'GET',
        url: 'https://bitpay.com/api/rates',
        dataType: 'json',
        async: false,
			success: function (response) {
				$.each(response, function(idx, obj) {
					if(obj.code == 'USD'){
						var livechart = jQuery('.chart').html(obj.rate);
						localStorage.setItem('livechart', livechart);
						return false;
					}
					if(localStorage.getItem('livechart')) {
						$('chart').append(localStorage.getItem('livechart'));
					}
				});
			}
		});

		
	}
	else
	{
		window.location='login.html';
	}
});

//******* Precious Metal Price - HORIZONTAL BAR CHART
//Oceania
var rawData1 = [
    [year(100), 7513], [year(110), 7600], [year(120), 7668], [year(130), 7700], [year(140), 7660],
    [year(150), 7558], [year(160), 7662], [year(170), 7558], [year(180), 7449]
];


var dataSet = [
    {  data: rawData1, color: "#00aa00" }
];

var options = {
    series: {
        lines: {
            show: true
        }
    },
    xaxis: {
        axisLabel: "Year",
        axisLabelUseCanvas: true,
        axisLabelFontSizePixels: 12,
        axisLabelFontFamily: 'Verdana, Arial',
        axisLabelPadding: 100,        
        mode: "time",
        tickSize: [10, "year"],
        timeformat: "%Y"
    },
    yaxis: {
        axisLabel: "Population (multiply by 10,000)",
        axisLabelUseCanvas: true,
        axisLabelFontSizePixels: 12,
        axisLabelFontFamily: 'Verdana, Arial',
        axisLabelPadding: 2,
        tickFormatter: function (v, axis) {
            return $.formatNumber(v, { format: "#,###", locale: "us" });
        }
    }
};

$(document).ready(function () {
    $.plot($("#flot-placeholder"), dataSet, options);    
    $("#flot-placeholder").UseTooltip();
});

function year(year) {    
    return new Date(year, 1, 1).getTime();
}


var previousPoint = null, previousLabel = null;

$.fn.UseTooltip = function () {
    $(this).bind("plothover", function (event, pos, item) {
        if (item) {
            if ((previousLabel != item.series.label) || 
                 (previousPoint != item.dataIndex)) {
                previousPoint = item.dataIndex;
                previousLabel = item.series.label;
                $("#tooltip").remove();

                var x = item.datapoint[0];
                var y = item.datapoint[1];

                var color = item.series.color;
                //alert(color)
                //console.log(item.series.xaxis.ticks[x].label);                
                
                showTooltip(item.pageX,
                        item.pageY,
                        color,
                        "<strong>" + item.series.label + "</strong><br>" + new Date(x).getFullYear() +
                        " : <strong>Population : " + $.formatNumber(y, { format: "#,###", locale: "us" }) + "</strong>  (multiply by 10,000)");                
            }
        } else {
            $("#tooltip").remove();
            previousPoint = null;
        }
    });
};

function showTooltip(x, y, color, contents) {
    $('<div id="tooltip">' + contents + '</div>').css({
        position: 'absolute',
        display: 'none',
        top: y - 10,
        left: x + 10,
        border: '2px solid ' + color,
        padding: '3px',
        'font-size': '9px',
        'border-radius': '5px',
        'background-color': '#fff',
        'font-family': 'Verdana, Arial, Helvetica, Tahoma, sans-serif',
        opacity: 0.9
    }).appendTo("body").fadeIn(200);
}



</script>
</head>
<body>

<div id="main_wrapper" class="inner-page" ontouchmove="touchMove(event)">
	<div class="main-container">
	<div id="topbar" class="navigation">
		
			<div class="header">
				<a href="#menu"><span></span></a>
			</div>
			<nav id="menu">
				<ul>
					
					<li class="menutop">
						<span class="profile-icon"></span>
						<span class="name"></span>
						<span class="email">
							<span class="uemail"></span>
							<span class="verify"></span></span>
						</span>
					</li>
					
					<li class="tbl" style="padding-top: 2px; padding-bottom: 10px;">
					<table>
						<tr>
							<td class="picon"><img src="images/home.png"></td>
							<td>&nbsp;&nbsp;&nbsp;</td>
							<td class="ptxt"><a href="dashboard.html">Home</a></td>
						</tr>
					</table>
					</li>
					<li class="tbl" style="padding-top: 2px; padding-bottom: 10px;">
					<table>
						<tr>
							<td class="picon"><img src="images/prepaid-card-in-a-hand.png"></td>
							<td>&nbsp;&nbsp;&nbsp;</td>
							<td class="ptxt"><a href="dashboard.html">Digi Card</a></td>
						</tr>
					</table>
					</li>
					<li class="tbl" style="padding-top:2px; padding-bottom:10px;">
					<table>
						<tr>
							<td class="picon"><img src="images/setting2.png"></td>
							<td>&nbsp;&nbsp;&nbsp;</td>
							<td class="ptxt"><a href="setting.html">Setting</a></td>
						</tr>
					</table>
					</li>
					<li class="Divider">Communicate</li>
					<li class="tbl" style="padding-top: 36px; padding-bottom: 10px;">
					<table>
						<tr>
							<td class="picon"><img src="images/support.png">  </td>
							<td>&nbsp;&nbsp;&nbsp;</td>
							<td class="ptxt"><a href="support.html">Support</a></td>
						</tr>
					</table>
					</li>
					<li class="tbl" style="padding-top: 4px; padding-bottom: 10px;">
					<table>
						<tr>
							<td class="picon"><img src="images/logout.png"></td>
							<td>&nbsp;&nbsp;&nbsp;</td>
							<td class="ptxt"><a href="login.html">Signout</a></td>
						</tr>
					</table>
					</li>
				</ul>
			</nav>
		<div class="header-card">Digi Card</div>
		<div class="notification" style="float:right; margin-left:-9px;">
			<a href="notifications.html"><img src="images/notification_title_menu.png"/></a>
			<span class="back" style="display:none;"><a herf="dashboard.html"><img src="images/close.png" style="margin-left:22px;"/></a></span>
		
		</div>
	</div>
	<div class="container">
	<div class="digidash-line">
		<div class="digi-header">
			<div class="digi">
				Your DIGI Card number</div>
			<div class="digi-num">
				<div></div>
			</div>
			<div class="digi-text">
				<div class="card_type"></div>
			</div>
		</div>
	</div>
		<div class="dash-button">
			<div class="dash-green-button">
				<a href="transact.html" class="green-transact-button">Transact</a>
			</div>
			<div class="dash-red-button">
				<a href="history.html" class="red-history-button">History</a>
			</div>
		</div>
		<div class="price-chart">
		Live Price Chart - BTC <img src="images/arrow_down.png"/>
			
		</div><div class="chart1"><div id="flot-placeholder"></div></div>
		
		<table class="dash-footer">
		<tr>
			<td class="balance">Balance <img src="images/bitcoin_logo.png"/></td>
			<td style="text-align:center;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
			<td class="live-market">Live Market <img src="images/dollar_icon.png"/></td>
		</tr>
		<tr>
			<td class="balance-footer"></td>
			<td>&nbsp;&nbsp;&nbsp;</td>
			<td class="live-footer">$ <span class="amount"></span></td>
		</tr>
		</table>
	</div>
	</div>
</body>
</html>